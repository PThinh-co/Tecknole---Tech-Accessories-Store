<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th√¥ng tin c√° nh√¢n - Tecknole</title>
  <link rel="stylesheet" href="assets/css/reset.css">
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .profile-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
    }

    .sidebar {
      background: white;
      border-radius: 15px;
      padding: 30px;
      height: fit-content;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
    }

    .sidebar-menu li {
      margin-bottom: 10px;
    }

    .sidebar-menu a, .sidebar-menu button {
      display: block;
      padding: 15px 20px;
      background: #f5f5f5;
      border-radius: 10px;
      text-decoration: none;
      color: var(--text-color-one);
      font-weight: 600;
      transition: all 0.3s;
      border: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
    }

    .sidebar-menu a:hover, .sidebar-menu button:hover {
      background: var(--color-one);
      color: white;
      transform: translateX(5px);
    }

    .sidebar-menu a.active {
      background: var(--color-one);
      color: white;
    }

    .main-content {
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      color: var(--text-color-one);
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    .form-group input:focus, .form-group select:focus {
      border-color: var(--color-one);
      outline: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-one), var(--color-two));
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(81, 112, 255, 0.4);
    }

    .info-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .info-row:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 600;
      color: #666;
    }

    .info-value {
      color: var(--text-color-one);
      font-weight: 500;
    }

    .order-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .order-id {
      font-weight: 700;
      color: var(--text-color-one);
      font-size: 16px;
    }

    .order-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .order-items {
      margin: 15px 0;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      color: #666;
    }

    .order-total {
      text-align: right;
      font-size: 18px;
      font-weight: 700;
      color: var(--color-one);
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid #e0e0e0;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state img {
      width: 200px;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    @media (max-width: 768px) {
      .profile-container {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        order: 2;
      }
      
      .main-content {
        order: 1;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-top">
      <div class="inner-logo">
        <a href="index.html">
          <img src="assets/images/logoteck.png" alt="logotecknole">
          <span>Tecknole</span>
        </a>
      </div>
      <div class="user-actions">
        <a href="login.html" class="login">ƒêƒÉng nh·∫≠p</a>
        <a href="register.html" class="register">ƒêƒÉng k√≠</a>
        <a href="cart.html" class="cart cart-badge">Gi·ªè h√†ng <span>0</span></a>
      </div>
    </div>
  </header>

  <div class="profile-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <ul class="sidebar-menu">
        <li><a href="#" class="menu-link active" data-section="info">üìã Th√¥ng tin c√° nh√¢n</a></li>
        <li><a href="#" class="menu-link" data-section="edit">‚úèÔ∏è Ch·ªânh s·ª≠a th√¥ng tin</a></li>
        <li><a href="#" class="menu-link" data-section="orders">üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
        <li><a href="#" class="menu-link" data-section="password">üîí ƒê·ªïi m·∫≠t kh·∫©u</a></li>
        <li><button onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button></li>
      </ul>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <!-- Th√¥ng tin c√° nh√¢n -->
      <div class="section active" id="info-section">
        <h2>Th√¥ng tin c√° nh√¢n</h2>
        <div class="info-card">
          <div class="info-row">
            <span class="info-label">H·ªç v√† t√™n:</span>
            <span class="info-value" id="display-fullname">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">Email:</span>
            <span class="info-value" id="display-email">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">T√™n ƒëƒÉng nh·∫≠p:</span>
            <span class="info-value" id="display-username">-</span>
          </div>
          <div class="info-row">
            <span class="info-label">S·ªë ƒëi·ªán tho·∫°i:</span>
            <span class="info-value" id="display-phone">Ch∆∞a c·∫≠p nh·∫≠t</span>
          </div>
          <div class="info-row">
            <span class="info-label">ƒê·ªãa ch·ªâ:</span>
            <span class="info-value" id="display-address">Ch∆∞a c·∫≠p nh·∫≠t</span>
          </div>
        </div>
      </div>

      <!-- Ch·ªânh s·ª≠a th√¥ng tin -->
      <div class="section" id="edit-section">
        <h2>Ch·ªânh s·ª≠a th√¥ng tin</h2>
        <form id="edit-form">
          <div class="form-group">
            <label>H·ªç v√† t√™n *</label>
            <input type="text" id="edit-fullname" required>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" id="edit-email" required>
          </div>
          <div class="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <input type="tel" id="edit-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
          </div>
          <div class="form-group">
            <label>ƒê·ªãa ch·ªâ</label>
            <input type="text" id="edit-address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ªßa b·∫°n">
          </div>
          <button type="submit" class="btn-primary">üíæ L∆∞u thay ƒë·ªïi</button>
        </form>
      </div>

      <!-- ƒê∆°n h√†ng -->
      <div class="section" id="orders-section">
        <h2>ƒê∆°n h√†ng c·ªßa t√¥i</h2>
        <div id="orders-list"></div>
      </div>

      <!-- ƒê·ªïi m·∫≠t kh·∫©u -->
      <div class="section" id="password-section">
        <h2>ƒê·ªïi m·∫≠t kh·∫©u</h2>
        <form id="password-form">
          <div class="form-group">
            <label>M·∫≠t kh·∫©u hi·ªán t·∫°i *</label>
            <input type="password" id="current-password" required>
          </div>
          <div class="form-group">
            <label>M·∫≠t kh·∫©u m·ªõi *</label>
            <input type="password" id="new-password" required minlength="6">
          </div>
          <div class="form-group">
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi *</label>
            <input type="password" id="confirm-password" required>
          </div>
          <button type="submit" class="btn-primary">üîí ƒê·ªïi m·∫≠t kh·∫©u</button>
        </form>
      </div>
    </div>
  </div>

  <script src="assets/js/auth.js"></script>
  <script>
    // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
    if (!requireLogin()) {
      // ƒê√£ ƒë∆∞·ª£c chuy·ªÉn h∆∞·ªõng b·ªüi requireLogin()
    }

    const user = getCurrentUser();
    const users = JSON.parse(localStorage.getItem('users')) || [];
    const currentUserData = users.find(u => u.username === user.username);

    // Hi·ªÉn th·ªã th√¥ng tin
    function displayUserInfo() {
      document.getElementById('display-fullname').textContent = currentUserData.fullname || '-';
      document.getElementById('display-email').textContent = currentUserData.email || '-';
      document.getElementById('display-username').textContent = currentUserData.username || '-';
      document.getElementById('display-phone').textContent = currentUserData.phone || 'Ch∆∞a c·∫≠p nh·∫≠t';
      document.getElementById('display-address').textContent = currentUserData.address || 'Ch∆∞a c·∫≠p nh·∫≠t';

      // Fill form ch·ªânh s·ª≠a
      document.getElementById('edit-fullname').value = currentUserData.fullname || '';
      document.getElementById('edit-email').value = currentUserData.email || '';
      document.getElementById('edit-phone').value = currentUserData.phone || '';
      document.getElementById('edit-address').value = currentUserData.address || '';
    }

    // Hi·ªÉn th·ªã ƒë∆°n h√†ng
    function displayOrders() {
      const orders = JSON.parse(localStorage.getItem(`orders_${user.username}`)) || [];
      const ordersList = document.getElementById('orders-list');

      if (orders.length === 0) {
        ordersList.innerHTML = `
          <div class="empty-state">
            <p style="font-size: 18px; color: #999;">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
            <a href="products.html" class="btn-primary" style="display: inline-block; margin-top: 20px; text-decoration: none;">Mua s·∫Øm ngay</a>
          </div>
        `;
        return;
      }

      ordersList.innerHTML = orders.reverse().map((order, index) => `
        <div class="order-card">
          <div class="order-header">
            <div>
              <div class="order-id">ƒê∆°n h√†ng #${orders.length - index}</div>
              <div style="font-size: 12px; color: #999; margin-top: 5px;">
                ${new Date(order.orderDate).toLocaleString('vi-VN')}
              </div>
            </div>
            <span class="order-status status-${order.status}">
              ${order.status === 'pending' ? '‚è≥ ƒêang x·ª≠ l√Ω' : '‚úÖ Ho√†n th√†nh'}
            </span>
          </div>
          <div class="order-items">
            ${order.items.map(item => `
              <div class="order-item">
                <span>${item.name} √ó ${item.quantity}</span>
                <span>${(item.price * item.quantity).toLocaleString()}ƒë</span>
              </div>
            `).join('')}
          </div>
          ${order.shippingAddress ? `
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; color: #666;">
              <strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> ${order.shippingAddress}
            </div>
          ` : ''}
          ${order.paymentMethod ? `
            <div style="margin-top: 10px; color: #666;">
              <strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> ${order.paymentMethod === 'cash' ? 'üíµ Ti·ªÅn m·∫∑t' : 'üí≥ Chuy·ªÉn kho·∫£n'}
            </div>
          ` : ''}
          <div class="order-total">
            T·ªïng c·ªông: ${order.total.toLocaleString()}ƒë
          </div>
        </div>
      `).join('');
    }

    // Menu navigation
    document.querySelectorAll('.menu-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class
        document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        
        // Add active class
        this.classList.add('active');
        const section = this.dataset.section;
        document.getElementById(`${section}-section`).classList.add('active');

        // Load orders when switching to orders tab
        if (section === 'orders') {
          displayOrders();
        }
      });
    });

    // Ch·ªânh s·ª≠a th√¥ng tin
    document.getElementById('edit-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const newFullname = document.getElementById('edit-fullname').value.trim();
      const newEmail = document.getElementById('edit-email').value.trim();
      const newPhone = document.getElementById('edit-phone').value.trim();
      const newAddress = document.getElementById('edit-address').value.trim();

      // Update user data
      currentUserData.fullname = newFullname;
      currentUserData.email = newEmail;
      currentUserData.phone = newPhone;
      currentUserData.address = newAddress;

      // Save to localStorage
      const userIndex = users.findIndex(u => u.username === user.username);
      users[userIndex] = currentUserData;
      localStorage.setItem('users', JSON.stringify(users));

      // Update current user session
      const updatedUser = {
        fullname: newFullname,
        email: newEmail,
        username: user.username,
        phone: newPhone,
        address: newAddress
      };
      localStorage.setItem('currentUser', JSON.stringify(updatedUser));

      alert('‚úÖ C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!');
      displayUserInfo();
      updateHeaderUI();

      // Switch to info tab
      document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelector('[data-section="info"]').classList.add('active');
      document.getElementById('info-section').classList.add('active');
    });

    // ƒê·ªïi m·∫≠t kh·∫©u
    document.getElementById('password-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const currentPassword = document.getElementById('current-password').value;
      const newPassword = document.getElementById('new-password').value;
      const confirmPassword = document.getElementById('confirm-password').value;

      if (currentPassword !== currentUserData.password) {
        alert('‚ùå M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!');
        return;
      }

      if (newPassword.length < 6) {
        alert('‚ùå M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±!');
        return;
      }

      if (newPassword !== confirmPassword) {
        alert('‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!');
        return;
      }

      // Update password
      currentUserData.password = newPassword;
      const userIndex = users.findIndex(u => u.username === user.username);
      users[userIndex] = currentUserData;
      localStorage.setItem('users', JSON.stringify(users));

      alert('‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
      this.reset();
    });

    // Initialize
    displayUserInfo();
  </script>
</body>
</html>